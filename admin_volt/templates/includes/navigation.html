{% load static %}

<nav class="navbar navbar-top navbar-expand navbar-dashboard navbar-dark ps-0 pe-2 pb-0">
	<div class="container-fluid px-0">
		<div class="d-flex justify-content-between w-100"
			 id="navbarSupportedContent">
			<div class="d-flex align-items-center">
				<img src="{% static 'nttulogo.jpg' %}"
					 class="avatar rounded-circle"
				style="width: 10%;height: auto">
				<div class="media-body ms-2 text-dark align-items-center d-none d-lg-block">
					<p class="mb-0 fs-1 fw-bolder text-gray-900">國立臺東大學電力診斷系統</p>
				</div>
			</div>

			<!-- Navbar links -->
			<ul class="navbar-nav align-items-center">
				{% if request.user.is_authenticated %}
					<button type="button"
							class="btn btn-primary"
							data-bs-toggle="modal"
							data-bs-target="#exampleModal">上傳資料
					</button>
				{% endif %}
				<li class="nav-item dropdown ms-lg-3">
					<a class="nav-link  pt-1 px-0"
					   href="#"
					   role="button"
					   data-bs-toggle="dropdown"
					   aria-expanded="false">
						<div class="media d-flex align-items-center">
							<img class="avatar rounded-circle"
								 alt="Image placeholder"
								 src="{% static 'assets/img/team/profile-picture-3.jpg' %}">
							<div class="media-body ms-2 text-dark align-items-center">
								<span class="mb-0 font-medium fw-bold text-gray-900">{{ user.username }}</span>
							</div>
						</div>
					</a>
					<div class="dropdown-menu dashboard-dropdown dropdown-menu-end mt-2 py-1">
{#						<a class="dropdown-item d-flex align-items-center"#}
{#						   href="#">#}
{#							<svg class="dropdown-icon text-gray-400 me-2"#}
{#								 fill="currentColor"#}
{#								 viewBox="0 0 20 20"#}
{#								 xmlns="http://www.w3.org/2000/svg">#}
{#								<path fill-rule="evenodd"#}
{#									  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z"#}
{#									  clip-rule="evenodd"></path>#}
{#							</svg>#}
{#							My Profile#}
{#						</a>#}
						{% if request.user.is_superuser %}
							<div role="separator"
								 class="dropdown-divider my-1"></div>
							<a class="dropdown-item d-flex align-items-center"
							   href="{% url 'admin:password_change' %}">
								<svg class="dropdown-icon text-gray-400 me-2"
									 fill="currentColor"
									 viewBox="0 0 20 20"
									 xmlns="http://www.w3.org/2000/svg">
									<path fill-rule="evenodd"
										  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0c0 .993-.241 1.929-.668 2.754l-1.524-1.525a3.997 3.997 0 00.078-2.183l1.562-1.562C15.802 8.249 16 9.1 16 10zm-5.165 3.913l1.58 1.58A5.98 5.98 0 0110 16a5.976 5.976 0 01-2.516-.552l1.562-1.562a4.006 4.006 0 001.789.027zm-4.677-2.796a4.002 4.002 0 01-.041-2.08l-.08.08-1.53-1.533A5.98 5.98 0 004 10c0 .954.223 1.856.619 2.657l1.54-1.54zm1.088-6.45A5.974 5.974 0 0110 4c.954 0 1.856.223 2.657.619l-1.54 1.54a4.002 4.002 0 00-2.346.033L7.246 4.668zM12 10a2 2 0 11-4 0 2 2 0 014 0z"
										  clip-rule="evenodd"></path>
								</svg>
								Change Password
							</a>
							<a class="dropdown-item d-flex align-items-center"
							   href="{% url 'admin:logout' %}">
								<svg class="dropdown-icon text-danger me-2"
									 fill="none"
									 stroke="currentColor"
									 viewBox="0 0 24 24"
									 xmlns="http://www.w3.org/2000/svg">
									<path stroke-linecap="round"
										  stroke-linejoin="round"
										  stroke-width="2"
										  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
									</path>
								</svg>
								Logout
							</a>
						{% else %}
							{% if request.user.is_authenticated %}
								<div role="separator"
									 class="dropdown-divider my-1"></div>
								<a class="dropdown-item d-flex align-items-center"
								   href="{% url 'logout' %}">
									<svg class="dropdown-icon text-danger me-2"
										 fill="none"
										 stroke="currentColor"
										 viewBox="0 0 24 24"
										 xmlns="http://www.w3.org/2000/svg">
										<path stroke-linecap="round"
											  stroke-linejoin="round"
											  stroke-width="2"
											  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
										</path>
									</svg>
									Logout
								</a>
							{% endif %}
						{% endif %}
					</div>
				</li>
			</ul>
		</div>
	</div>
</nav>
<div class="modal fade"
	 id="exampleModal"
	 tabindex="-1"
	 aria-labelledby="exampleModalLabel"
	 aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title"
					id="exampleModalLabel">上傳資料</h5>
				<button type="button"
						class="btn-close"
						data-bs-dismiss="modal"
						aria-label="Close"></button>
			</div>
			<div id="errorMessage"
				 class="text-danger"></div>
			<form method="POST"
				  id="uploadForm"
				  action="{% url 'upload_data' %}"
				  enctype="multipart/form-data">
				{% csrf_token %}
				<div class="modal-body">
					<input type="file"
						   name="csv_file">
				</div>
				<div class="modal-footer">
					<button type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal">關閉
					</button>
					<button type="submit"
							id="submitButton"
							class="btn btn-primary">上傳
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script>
    const successMessage = "{{ message|escapejs }}"; // 確保訊息內容安全
    if (successMessage == "success upload") {
        alert(successMessage); // 在頁面載入時使用 alert 顯示成功訊息
    }
    document.addEventListener("DOMContentLoaded", function () {
        const uploadForm = document.getElementById("uploadForm");
        const submitButton = document.getElementById("submitButton");
        const errorMessage = document.getElementById("errorMessage");

        uploadForm.addEventListener("submit", function (event) {
            event.preventDefault(); // 阻止表單的預設提交行為
            const fileInput = document.querySelector("input[name='csv_file']");
            const file = fileInput.files[0];

            if (!file) {
                errorMessage.textContent = "請選擇要上傳的 CSV 檔案。";
                return;
            }

            if (!file.name.endsWith(".csv")) {
                errorMessage.textContent = "請上傳一個有效的 CSV 檔案。";
                return;
            }

            // 使用 FileReader 讀取檔案內容
            const fileReader = new FileReader();
            fileReader.onload = function (event) {
                const fileContent = event.target.result;
                // 在這裡進行 CSV 檔案內容的檢查
                // 例如，你可以使用逗號分隔進行分割，並檢查每個欄位是否符合要求
                const lines = fileContent.split("\n");
                // 進一步的檢查和處理
            };

            uploadForm.submit(); // 提交表單
        });
    });
</script>