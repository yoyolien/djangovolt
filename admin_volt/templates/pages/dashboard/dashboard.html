{% extends 'layouts/base.html' %}
{% load static %}
{% block content %}
<!-- {#    <link rel="stylesheet" id="style-link-2" href="{% static "css/loading.css" %}">#} -->
    <style>
        .tooltipa {
            position: relative;
            display: inline-block;
            /* border-bottom: 1px dotted black; */
        }

        .tooltipa .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 5px 0;

            /* 定位 */
            position: absolute;
            z-index: 1;
        }

        .tooltipa:hover .tooltiptext {
            visibility: visible;
        }

        .ct-series .ct-series-a {
            color: red; /* 將折線的顏色設置為紅色 */
        }

        .ct-series .ct-area {
            fill: purple; /* 區域填充顏色為紅色 */
        }

    </style>
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card bg-yellow-100 border-0 shadow">
                <div class="card-header d-sm-flex flex-row align-items-center flex-0">
                    <div class="d-block mb-3 mb-sm-0">

                        <h2 class="fs-3 fw-extrabold"
                            id="use"></h2>
                        <div class="small mt-2">
                            <span class="fw-normal me-2">與上月相比</span>
                            <span class="fas fa-angle-up text-success"></span>
                            <span class="text-success fw-bold"
                                  id="compare"></span>
                        </div>
                    </div>
                    <div class="d-flex ms-auto">
                        <label for="start-date">開始日期：</label>
                        <input type="date" id="start-date" name="start-date"><br><br>

                        <label for="end-date">結束日期：</label>
                        <input type="date" id="end-date" name="end-date"><br><br>

                        <button onclick="showSelectedDates()">顯示所選日期</button>
                        <!-- ------------------------------------------------- -->

                        <a href="#"
                           class="btn btn-secondary text-dark btn-sm me-3"
                           id="day-btn">Day</a>
                        <a href="#"
                           class="btn btn-dark btn-sm me-3"
                           id="week-btn">Week</a>
                        <select id="monthSelect">
                            <option value="1">1月</option>
                            <option value="2">2月</option>
                            <option value="3">3月</option>
                            <option value="4">4月</option>
                            <option value="5">5月</option>
                            <option value="6">6月</option>
                            <option value="7">7月</option>
                            <option value="8">8月</option>
                            <option value="9">9月</option>
                            <option value="10">10月</option>
                            <option value="11">11月</option>
                            <option value="12">12月</option>
                        </select>
                    </div>
                </div>

                <div class="card-body p-2"
                     id="containbox"
                     style="overflow-x: auto;">
                    <div class=""
                         id="charttest"
                         style="width: 100%; height: 500px;">
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col-12 col-sm-6 col-xl-4 mb-4">
            <div class="card border-0 shadow">
                <div class="card-body">
                    <div class="row d-block d-xl-flex align-items-center">
                        <div
                                class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <!-- 電量圖示 -->
                            <div class="icon-shape icon-shape-primary rounded me-4 me-sm-0">
                                <svg width="800px"
                                     height="800px"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg"
                                     xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <defs>
                                        <polygon id="thunder-a"
                                                 points="2.977 8.161 8.269 9.241 .218 18.519 1.882 19.604 12.128 8.161 5.893 6.809 8.821 .998 7.387 .185"/>
                                        <path id="thunder-c"
                                              d="M10.2577032,5.88540233 L13.3683613,6.4682972 C14.894984,6.75436548 15.5271239,8.59550311 14.4981974,9.75899885 L5.15432684,20.3249168 C3.62851509,22.0502834 0.875362777,20.253925 1.83997631,18.1623916 L4.9166534,11.4913543 L2.63023839,11.061225 C1.27422934,10.8061273 0.577759703,9.28698125 1.26946216,8.09308716 L5.3804761,0.997384038 C5.7381351,0.380056504 6.3975623,0 7.11101395,0 L10.1949866,0 C11.7353835,0 12.697534,1.66821829 11.9261411,3.00155082 L10.2577032,5.88540233 Z M10.1949866,2 L7.11101395,2 L3,9.09570312 L7.80692226,10 L3.65612945,19 L13,8.43408203 L7.11101395,7.33056641 L10.1949866,2 Z"/>
                                    </defs>
                                    <g fill="none"
                                       fill-rule="evenodd"
                                       transform="translate(4 2)">
                                        <g transform="translate(2)">
                                            <mask id="thunder-b"
                                                  fill="#ffffff">
                                                <use xlink:href="#thunder-a"/>
                                            </mask>
                                            <use fill="#D8D8D8"
                                                 xlink:href="#thunder-a"/>
                                            <g fill="#FFA0A0"
                                               mask="url(#thunder-b)">
                                                <rect width="24"
                                                      height="24"
                                                      transform="translate(-6 -2)"/>
                                            </g>
                                        </g>
                                        <mask id="thunder-d"
                                              fill="#ffffff">
                                            <use xlink:href="#thunder-c"/>
                                        </mask>
                                        <use fill="#000000"
                                             fill-rule="nonzero"
                                             xlink:href="#thunder-c"/>
                                        <g fill="#7600FF"
                                           mask="url(#thunder-d)">
                                            <rect width="24"
                                                  height="24"
                                                  transform="translate(-4 -2)"/>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                                <h2 class="h6 text-gray-400 mb-0">該月平均電力用量</h2>
                                <h3 class="fw-extrabold mb-2"><span id="average used"></span>度</h3>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-xl-4 mb-4">
            <div class="card border-0 shadow">
                <div class="card-body">
                    <div class="row d-block d-xl-flex align-items-center">
                        <div
                                class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <!-- 警告圖示 -->
                            <div class="icon-shape icon-shape-secondary rounded me-4 me-sm-0">
                                <svg width="800px"
                                     height="800px"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg"
                                     xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <defs>
                                        <polygon id="alert-a"
                                                 points="2.758 .388 19.133 .388 21.288 4.068 19.896 4.965 2.592 4.965 .87 4.068"/>
                                        <path id="alert-c"
                                              d="M12,2 L3,18 L21,18 L12,2 Z M10.2568489,1.01947752 C11.0214571,-0.33982584 12.9785429,-0.33982584 13.7431511,1.01947752 L22.7431511,17.0194775 C23.4930806,18.3526856 22.529653,20 21,20 L3,20 C1.47034705,20 0.506919374,18.3526856 1.25684893,17.0194775 L10.2568489,1.01947752 Z M11,11 L11,16 C11,16.5522847 11.4477153,17 12,17 C12.5522847,17 13,16.5522847 13,16 L13,11 C13,10.4477153 12.5522847,10 12,10 C11.4477153,10 11,10.4477153 11,11 Z M12,9 C12.5522847,9 13,8.55228475 13,8 C13,7.44771525 12.5522847,7 12,7 C11.4477153,7 11,7.44771525 11,8 C11,8.55228475 11.4477153,9 12,9 Z"/>
                                    </defs>
                                    <g fill="none"
                                       fill-rule="evenodd"
                                       transform="translate(0 2)">
                                        <g transform="translate(1 14)">
                                            <mask id="alert-b"
                                                  fill="#ffffff">
                                                <use xlink:href="#alert-a"/>
                                            </mask>
                                            <use fill="#D8D8D8"
                                                 xlink:href="#alert-a"/>
                                            <g fill="#FFA0A0"
                                               mask="url(#alert-b)">
                                                <rect width="24"
                                                      height="24"
                                                      transform="translate(-1 -16)"/>
                                            </g>
                                        </g>
                                        <mask id="alert-d"
                                              fill="#ffffff">
                                            <use xlink:href="#alert-c"/>
                                        </mask>
                                        <use fill="#000000"
                                             fill-rule="nonzero"
                                             xlink:href="#alert-c"/>
                                        <g fill="#7600FF"
                                           mask="url(#alert-d)">
                                            <rect width="24"
                                                  height="24"
                                                  transform="translate(0 -2)"/>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                                <h2 class="h6 text-gray-400 mb-0">該月異常天數</h2>
                                <h3 class="fw-extrabold mb-2"><span id="overstandard"></span>天</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-xl-4 mb-4">
            <div class="card border-0 shadow">
                <div class="card-body">
                    <div class="row d-block d-xl-flex align-items-center">
                        <div
                                class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
                            <!-- 樹圖案 -->
                            <div class="icon-shape icon-shape-tertiary rounded me-4 me-sm-0">
                                <svg version="1.0"
                                     id="Layer_1"
                                     xmlns="http://www.w3.org/2000/svg"
                                     xmlns:xlink="http://www.w3.org/1999/xlink"
                                     width="800px"
                                     height="800px"
                                     viewBox="0 0 64 64"
                                     enable-background="new 0 0 64 64"
                                     xml:space="preserve">
                <g>
                  <path fill="#394240"
                        d="M56.414,48.586L47.828,40H51c0.809,0,1.538-0.486,1.848-1.234s0.139-1.607-0.434-2.18L43.828,28H47
                    c0.809,0,1.538-0.486,1.848-1.234s0.139-1.607-0.434-2.18L39.828,16H43c0.809,0,1.538-0.486,1.848-1.234s0.139-1.607-0.434-2.18
                    l-12-12C32.023,0.195,31.512,0,31,0s-1.023,0.195-1.414,0.586l-12,12c-0.572,0.572-0.743,1.432-0.434,2.18S18.191,16,19,16h3.172
                    l-8.586,8.586c-0.572,0.572-0.743,1.432-0.434,2.18S14.191,28,15,28h3.172l-8.586,8.586c-0.572,0.572-0.743,1.432-0.434,2.18
                    S10.191,40,11,40h3.172l-8.586,8.586c-0.572,0.572-0.743,1.432-0.434,2.18S6.191,52,7,52h20v11c0,0.553,0.447,1,1,1h6
                    c0.553,0,1-0.447,1-1V52h20c0.809,0,1.538-0.486,1.848-1.234S56.986,49.158,56.414,48.586z M20,14c-0.547,0-0.789-0.211,0-1
                    c0.641-0.641,9-9,10-10s1-1,2,0c0,0,9.303,9.305,9.999,10s0.61,1,0.001,1C41.679,14,20.127,14,20,14z M16,26
                    c-0.547,0-0.766-0.234,0-1c0.444-0.443,5.951-5.951,9-9h12c3.001,3,8.384,8.385,9,9c0.859,0.859,0.469,1,0,1
                    C45.75,26,16.127,26,16,26z M12,38c-0.609,0-0.773-0.227,0-1c0.461-0.461,5.956-5.955,9-9h20c3.07,3.07,8.634,8.635,9,9
                    c0.648,0.648,0.656,1,0,1C49.479,38,12.135,38,12,38z M33,62h-4V52h4V62z M54,50c-1,0-45.297,0-46,0c-0.484,0-0.797-0.203,0-1
                    c0.478-0.477,5.96-5.961,9-9h28c3.065,3.066,8.614,8.615,9.002,9.002C54.695,49.695,54.578,50,54,50z"/>
                    <g>
                    <path fill="#B4CCB9"
                          d="M20,14c0.127,0,21.679,0,22,0c0.609,0,0.695-0.305-0.001-1S32,3,32,3c-1-1-1-1-2,0s-9.359,9.359-10,10
                      C19.211,13.789,19.453,14,20,14z"/>
                        <path fill="#B4CCB9"
                              d="M16,26c0.127,0,29.75,0,30,0c0.469,0,0.859-0.141,0-1c-0.616-0.615-5.999-6-9-9H25
                      c-3.049,3.049-8.556,8.557-9,9C15.234,25.766,15.453,26,16,26z"/>
                        <path fill="#B4CCB9"
                              d="M12,38c0.135,0,37.479,0,38,0c0.656,0,0.648-0.352,0-1c-0.366-0.365-5.93-5.93-9-9H21
                      c-3.044,3.045-8.539,8.539-9,9C11.227,37.773,11.391,38,12,38z"/>
                        <path fill="#B4CCB9"
                              d="M54.002,49.002C53.614,48.615,48.065,43.066,45,40H17c-3.04,3.039-8.522,8.523-9,9
                      c-0.797,0.797-0.484,1,0,1c0.703,0,45,0,46,0C54.578,50,54.695,49.695,54.002,49.002z"/>
                  </g>
                    <rect x="29"
                          y="52"
                          fill="#506C7F"
                          width="4"
                          height="10"/>
                </g>
                </svg>
                            </div>
                            <div class="d-sm-none">
                                <h2 class="fw-extrabold h5"> Bounce Rate</h2>
                                <h3 class="mb-1">50.88%</h3>
                            </div>
                        </div>
                        <div class="col-12 col-xl-7 px-xl-0">
                            <div class="d-none d-sm-block">
                                <h2 class="h6 text-gray-400 mb-0">該月需種植樹木數</h2>
                                <h3 class="fw-extrabold mb-2"><span id="tree"></span>59棵</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-xl-8">
            <div class="row">
                <div class="col-12 col-xxl-6 mb-4">
                    <div class="card border-0 shadow">
                        <div class="card-header border-bottom d-flex align-items-center justify-content-between">
                            <h2 class="fs-5 fw-bold mb-0">今年電力使用共: {{ wholeusage }} 度
                                約需要種植 {{ treec|length }} 棵樹</h2>
                            <!-- <a href="#" class="btn btn-sm btn-primary">See all</a> -->

                            <div class="tooltipa">
                                <svg class="icon icon-s text-gray-500 ms-2 me-1"
                                     fill="currentColor"
                                     viewBox="0 0 20 20"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path
                                            fill-rule="evenodd"
                                            clip-rule="evenodd"
                                            d="M0.877075 7.49972C0.877075 3.84204 3.84222 0.876892 7.49991 0.876892C11.1576 0.876892 14.1227 3.84204 14.1227 7.49972C14.1227 11.1574 11.1576 14.1226 7.49991 14.1226C3.84222 14.1226 0.877075 11.1574 0.877075 7.49972ZM7.49991 1.82689C4.36689 1.82689 1.82708 4.36671 1.82708 7.49972C1.82708 10.6327 4.36689 13.1726 7.49991 13.1726C10.6329 13.1726 13.1727 10.6327 13.1727 7.49972C13.1727 4.36671 10.6329 1.82689 7.49991 1.82689ZM8.24993 10.5C8.24993 10.9142 7.91414 11.25 7.49993 11.25C7.08571 11.25 6.74993 10.9142 6.74993 10.5C6.74993 10.0858 7.08571 9.75 7.49993 9.75C7.91414 9.75 8.24993 10.0858 8.24993 10.5ZM6.05003 6.25C6.05003 5.57211 6.63511 4.925 7.50003 4.925C8.36496 4.925 8.95003 5.57211 8.95003 6.25C8.95003 6.74118 8.68002 6.99212 8.21447 7.27494C8.16251 7.30651 8.10258 7.34131 8.03847 7.37854L8.03841 7.37858C7.85521 7.48497 7.63788 7.61119 7.47449 7.73849C7.23214 7.92732 6.95003 8.23198 6.95003 8.7C6.95004 9.00376 7.19628 9.25 7.50004 9.25C7.8024 9.25 8.04778 9.00601 8.05002 8.70417L8.05056 8.7033C8.05924 8.6896 8.08493 8.65735 8.15058 8.6062C8.25207 8.52712 8.36508 8.46163 8.51567 8.37436L8.51571 8.37433C8.59422 8.32883 8.68296 8.27741 8.78559 8.21506C9.32004 7.89038 10.05 7.35382 10.05 6.25C10.05 4.92789 8.93511 3.825 7.50003 3.825C6.06496 3.825 4.95003 4.92789 4.95003 6.25C4.95003 6.55376 5.19628 6.8 5.50003 6.8C5.80379 6.8 6.05003 6.55376 6.05003 6.25Z"
                                            fill="#000000"
                                    />
                                </svg>
                                <div class="tooltiptext">
                                        <span> 民國111年電力排碳係數為每度0.509公斤CO2e
                                        <a href="https://www.moea.gov.tw/MNS/populace/news/News.aspx?kind=1&menu_id=40&news_id=100931"
                                           class="text-danger">點我查看</a></span>
                                </div>

                            </div>
                        </div>

                        <div class="card-body">
                            {% for i,j in treec %}
                                <div class="image-container">
                                    <div class="cutimage"
                                         style="height: {{ i }}%; top: {{ j }}%;">
                                        <img src="{% static 'tree.png' %}">
                                    </div>

                                </div>
                            {% endfor %}
                        </div>

                        <a href="https://www.flaticon.com/free-stickers/joshua-tree"
                           title="joshua tree stickers"
                           style="font-size: 10px;">
                            Joshua tree stickers created by Gohsantosadrive - Flaticon
                        </a>
                    </div>
                </div>
                <div class="col-12 mb-4">
                    <div class="card border-0 shadow">
                        <div class="card-header">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h2 class="fs-5 fw-bold mb-0"
                                        id="compare2">各月用電量比較</h2>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table align-items-center table-flush">
                                <thead class="thead-light">
                                <tr>
                                    <th class="border-bottom"
                                        scope="col">日期
                                    </th>
                                    <th class="border-bottom"
                                        scope="col">用電量
                                    </th>
                                    <th class="border-bottom"
                                        scope="col">需種植樹木數量
                                    </th>
                                    <th class="border-bottom"
                                        scope="col">與前一日相比
                                    </th>
                                </tr>
                                </thead>
                                <tbody id="tb">
                                <tr id="trr">
                                    <th class="text-gray-900"
                                        scope="row"
                                        id="date2">
                                        /demo/admin/index.html
                                    </th>
                                    <td class="fw-bolder"
                                        id="ele2">
                                        3,225
                                    </td>
                                    <td class="fw-bolder"
                                        id="tree2">
                                        $20
                                    </td>
                                    <td class="fw-bolder"
                                        id="rate">
                                        <div class="d-flex">
                                            <svg class="icon icon-xs text-danger me-2"
                                                 fill="currentColor"
                                                 viewBox="0 0 20 20"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
                                                      clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-12 col-xl-4">
            <div class="card border-0 shadow mb-4">
                <!-- <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h2 class="fs-5 fw-bold mb-0">宿舍最新消息</h2>
                        </div>
                        <div class="col text-end">
                        </div>
                    </div>
                </div>
                                <div class="card-body"
{#                					 style="height: 300px;"#}
                                     id="loader-container">
                                    <div class="spinner-border"
                                         role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                <ul class="list-group list-group-flush">
                </ul>
            </div>
            <script>
                function hideLoader() {
                    document.getElementById("loader-container").style.display = "none";
{#                    document.getElementById("style-link-2").disabled = true;#}
                }
                fetch('/requestnttu')
                    .then(response => response.json())
                    .then(data => {
                        // 在這裡處理返回的 JSON 數據
                        var title = data.title;
                        var link = data.link;
                        console.log(title, link);
                        createli(title, link);
                    })
                    .catch(error => {
                        console.log(error);
                    });

                function createli(title, link) {
                    ul = document.querySelector(".list-group");
                    for (var i = 0; i < title.length; i++) {
                        var newListItem = document.createElement("li");
                        newListItem.className = "list-group-item";
                        var a = document.createElement("a");
                        a.href = link[i];
                        a.text = title[i];
                        newListItem.appendChild(a);
                        ul.appendChild(newListItem);
                    }
                    hideLoader();
                }
            </script> -->
            <div class="card border-0 shadow mb-4">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h2 class="fs-5 fw-bold mb-0">臺電最新消息</h2>
                        </div>
                        <div class="col text-end">
                        </div>
                    </div>

                </div>
                <div id="carouselExampleIndicators"
                     class="carousel slide"
                     data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators"
                            data-slide-to="0"
                            class="active"></li>
                        {% for slide in slides %}
                            <li data-target="#carouselExampleIndicators"
                                data-slide-to="{{ forloop.counter }}"></li>
                        {% endfor %}
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <a href="{{ fslide.link }}"
                               target="_blank"><img class="d-block w-100 carimg"
                                                    src="{{ fslide.image }}"
                                                    alt="0"></a>
                            <div><p class="text-justify font-weight-bold">
                                {{ fslide.description }}</p>
                            </div>
                        </div>
                        {% for slide in slides %}
                            <div class="carousel-item"><a href="{{ slide.link }}"
                                                          target="_blank">
                                <img class="d-block w-100 carimg"
                                     src="{{ slide.image }}"
                                     alt="{{ forloop.counter }}"></a>
                                <div><p class="text-justify font-weight-bold">
                                    {{ slide.description }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <a class="carousel-control-prev"
                       href="#carouselExampleIndicators"
                       role="button"
                       data-slide="prev">
							<span class="carousel-control-prev-icon"
                                  aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next"
                       href="#carouselExampleIndicators"
                       role="button"
                       data-slide="next">
							<span class="carousel-control-next-icon"
                                  aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h2 class="fs-5 fw-bold mb-0">SDGs各項指標介紹</h2>
                        </div>
                        <div class="col text-end">
                        </div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <a href="https://futurecity.cw.com.tw/article/836"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_1.png' %}">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1275"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_2.png' %}">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1285"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_3.png' %}">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1286"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_4.png' %}"
                             alt="SDG 4">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1287"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_5.png' %}"
                             alt="SDG 5">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1297"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_6.png' %}"
                             alt="SDG 6">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1298"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_7.png' %}"
                             alt="SDG 7">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1299"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_8.png' %}"
                             alt="SDG 8">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1296"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_9.png' %}"
                             alt="SDG 9">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1295"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_10.png' %}"
                             alt="SDG 10">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1294"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_11.png' %}"
                             alt="SDG 11">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1293"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_12.png' %}"
                             alt="SDG 12">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1292"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_13.png' %}"
                             alt="SDG 13">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1291"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_14.png' %}"
                             alt="SDG 14">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1290"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_15.png' %}"
                             alt="SDG 15">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1289"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_16.png' %}"
                             alt="SDG 16">
                    </a>
                    <a href="https://futurecity.cw.com.tw/article/1288"
                       target="_blank">
                        <img src="{% static 'sdglogo/TheGlobalGoals_Icons_Color_Goal_17.png' %}"
                             alt="SDG 17">
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script>
        var m = 0;
        var dateall ={{ date|safe }};//以陣列存放個月日期 ex.一月dateall[0]=>[1,2,3...,31]
        var eleall ={{ ele|safe }};//電力用量,跟dateall是對應的
        var total = {{ wholeusage|safe }};
        var weekdate = [];//存放日期從改成天改成周的資料
        var year = 2023;
        var result ={{ presult|safe }};
        var standard = {{ standard|safe }};//平均值
        var overstandard = 0;//日電力用量平均值
        var sum ={{ wholeusage|safe }};//電力用量總和
        var monthele = {{ monthusage|safe }};
        var tree = document.getElementById("tree");
        var wele = [];
        var p = 0;
        var mtree = [];
        var month_result = [];
        var first_day = [];
        var date=[];
        var ele=[];
        var t_result=[];

        function buildData(startDate,endDate){
            // console.log(dateall[startDate[0]-1]);
            date=[];
            ele=[];
            t_result=[];
            var start=[startDate[0]-1,dateall[startDate[0]-1].indexOf(startDate[1])];
            var end=[endDate[0]-1,dateall[endDate[0]-1].indexOf(endDate[1])];
            console.log(start,end);
            console.log("se");
            while(1){
                console.log(start,end);
                if(start[0]==end[0]&&start[1]==end[1]+1){
                    return 0;
                };
                // console.log(start[1]);
                if(start[1]==dateall[start[0]].length){
                    start[0]=start[0]+1;
                    start[1]=0;
                    // console.log("outofrange");
                    continue;
                }
                date.push(dateall[start[0]][start[1]]);
                ele.push(eleall[start[0]][start[1]]);
                t_result.push(month_result[start[0]][start[1]]);
                start[1]=start[1]+1;
            }
        }

        function showSelectedDates() {
            var startDate = document.getElementById("start-date").value;
            var endDate = document.getElementById("end-date").value;
            startDate=[parseInt(startDate.slice(5,7)),parseInt(startDate.slice(8,10))];
            endDate=[parseInt(endDate.slice(5,7)),parseInt(endDate.slice(8,10))];
            // alert(startDate,endDate);
            buildData(startDate,endDate);
            
            
            console.log(date);
            console.log(ele);
            console.log(t_result);
            cc(m);
        }

        function s() {
            for (var i = 0; i < 12; i++) {
                // console.log(eleall[i].length);
                month_result.push(result.slice(0, eleall[i].length));
                result = result.slice(eleall[i].length);
            }
        }

        s();
        console.log(month_result);

        function calmtree() {
            for (var i = 0; i < 12; i++) {
                mtree.push(0.509 * monthele[i] / 550.5);
                mtree[i] = mtree[i].toFixed(2);
            }
            // console.log(mtree);
        }

        calmtree();

        var use = document.getElementById('use');
        var compare = document.getElementById('compare');//與上月相比
        var monthSelect = document.getElementById('monthSelect');//月份選單
        var month_compare = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

        function calculate_month_rate() {

            for (var i = 1; i < 13; i++) {
                if (monthele[i] >= monthele[i - 1]) {
                    month_compare[i] = ((Math.round((monthele[i] / monthele[i - 1] - 1) * 100)) + '% ↑');
                } else {
                    month_compare[i] = (String(Math.round((1 - monthele[i] / monthele[i - 1]) * 100)) + '% ↓');
                }
            }

        }

        calculate_month_rate();

        function month_rate_switch() {
            // console.log(m);
            if (m == 0) compare.textContent = "NaN";
            else if (monthele[m] >= monthele[m - 1]) {
                compare.textContent = String(Math.round((monthele[m] / monthele[m - 1] - 1) * 100)) + '% ↑';
                compare.classList.remove("text-success");
                compare.classList.add("text-danger");
            } else {
                compare.textContent = String(Math.round((1 - monthele[m] / monthele[m - 1]) * 100)) + '% ↓';
                compare.classList.remove("text-danger");
                compare.classList.add("text-success");
            }
        }

        function weekcalculate() {
            for (var i = 0; i < 12; i++) {
                var name = [];
                var wele_n = [];
                var a = 1;
                var sumw = 0;
                for (var j = 0; j < eleall[i].length; j++) {
                    sumw += eleall[i][j];
                    if ((j + 1) % 7 == 0 || j == eleall[i].length - 1) {
                        wele_n.push(sumw.toFixed(2));
                        if (a == 1)
                            name.push(a + '-' + String(j + 1));
                        else
                            name.push(a + 1 + '-' + String(j + 1));
                        a = j + 1;
                        sumw = 0;
                        continue;
                    }
                }
                weekdate.push(name);
                wele.push(wele_n);
            }
        }


        function handleMonthChange() {
            var selectedMonth = monthSelect.value;
            var thv = standard[selectedMonth - 1];
            average.textContent = thv;
            use.textContent = String(selectedMonth) + '月總共使用' + String(monthele[selectedMonth - 1]) + '度';
            if (selectedMonth != 1)
                calculate_month_rate(selectedMonth - 1);
            else compare.textContent = "查無資料";
            calculate_overstandard(selectedMonth - 1);
            document.getElementById('overstandard').textContent = overstandard;
            m = selectedMonth - 1;
            month_rate_switch();
            tree.textContent = mtree[m];
            cc(m);
        }

        var tb = document.getElementById("tb");
        var origin_node = document.getElementById("trr");
        tb.removeChild(origin_node);
        var node;
        var dateElement;
        console.log("hi");
        console.log(result);

        function calculate_overstandard(a) {
            overstandard = 0;
            for (var i = 0; i < month_result[a].length; i++) {
                if (month_result[a][i] == "1") overstandard++;
            }
        }

        function list_rate() {
            setTimeout(function () {
                // compare.classList.add("text-danger");
                node = origin_node.cloneNode(true);
                node.children["date2"].textContent = 1;
                node.children["ele2"].textContent = monthele[0];
                var rate;
                for (var i = 1; i < 13; i++) {
                    node = origin_node.cloneNode(true);
                    node.children["date2"].textContent = i;
                    node.children["ele2"].textContent = monthele[i - 1];
                    node.children["tree2"].textContent = mtree[i - 1] + "棵";

                    if (monthele[i - 1] >= monthele[i - 2]) {
                        node.children["rate"].textContent = month_compare[i - 1];
                        node.children["rate"].classList.add("text-danger");
                    } else {
                        node.children["rate"].textContent = month_compare[i - 1];
                        node.children["rate"].classList.add("text-success");
                    }
                    // if(eles[i]>standard)node.children["ele2"].classList.add("text-danger");
                    // else if(eles[i]<standard)node.children["ele2"].classList.add("text-success");
                    node.setAttribute('id', String(i));
                    tb.appendChild(node);
                }
            }, 200);
        }

        function build_first_day() {
            for (var i = 0; i < 12; i++) {
                first_day[i] = eleall[i][0];
            }
        }

        function find_month(t) {
            for (var i = 0; i < 12; i++) {
                if (t == first_day[i]) return [i];
            }
        }

        compare.textContent = "NaN";
        tree.textContent = mtree[0];
        build_first_day();
        console.log(first_day);
        list_rate();
        weekcalculate();
        calculate_overstandard(0);

        // 添加事件監聽器，偵測下拉選單的變更事件

        //------------------------------------------------------------------------
        var chartDom = document.getElementById('charttest');
        var myChart = echarts.init(chartDom);
        var option;

        function cc(m) {
            var markAreadata = [];
            var markPointData = [];
                console.log(date);
                // console.log(dateall[m]);
                console.log(ele);
                // console.log(eleall[m]);
                for (var i = 0; i < ele.length; i++) {
                    // console.log(month_result[m][i]);
                    if (t_result[i] == '1') {
                        var markPoint = {
                            coord: [i, ele[i]], // 使用 [x, y] 坐標表示標記點位置
                            value: ele[i],
                            name: '數值: ' + ele[i] // 自定義標記點的名稱
                        };
                        var markarea = [
                            {
                                xAxis: i,
                            },
                            {
                                xAxis: i + 1,
                            }

                        ];
                        markPointData.push(markPoint);
                        markAreadata.push(markarea);
                    }
                }


                option = {
                    title: {
                        // text: 'Distribution of Electricity',
                        // subtext: '一月'
                    },
                    tooltip: {
                        trigger: 'item',
                        axisPointer: {
                            type: 'cross'
                        },
                        formatter: function (arg) {
                            console.log(arg);
                            if (arg.componentType === 'series') {
                                console.log(arg.componentType);
                                // return m + 1 + '月' + arg.name + '日\r' + "<br>" + '用電量 : ' + arg.value;
                            } else if (arg.componentType === 'markPoint') {
                                console.log(arg.componentType);
                                // return m + 1 + '月' + dateall[m][arg.data.coord[0]] + '日' + "<br>" + '用電量 : ' + arg.value
                            } else return '';
                        }
                    },
                    toolbox: {
                        show: false,
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        // prettier-ignore
                        data: date
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            formatter: '{value} 度'
                        },
                        axisPointer: {
                            snap: true
                        }
                    },
                    series: [
                        {
                            data: ele,

                            markPoint: {
                                data: markPointData,
                                itemStyle: {
                                    color: 'red',
                                    // borderColor: 'red',
                                    // borderWidth: 3
                                }
                            },
                            lineStyle: {
                                color: 'green', // 指定線條的顏色
                                width: 4.5
                            },
                            itemStyle: {
                                color: 'black', // 普通數據點的顏色
                                borderColor: 'red', // 普通數據點的邊框顏色
                                borderWidth: 2, // 普通數據點的邊框寬度
                                opacity: 0.7 // 普通數據點的透明度
                                // 其他樣式屬性
                            },
                            label: {
                                show: true,
                                formatter: function (params) {
                                    if (t_result[params.dataIndex] === '0') {
                                        return ele[i];
                                    } else {
                                        return '';
                                    }
                                },
                            },
                            name: '用電量(度)',
                            type: 'line',
                            smooth: true,
                            // prettier-ignore

                            markArea: {
                                itemStyle: {
                                    color: 'rgba(255, 173, 177, 0.4)'
                                },
                                data: markAreadata,

                            }
                        }
                    ]
                };
            
            option && myChart.setOption(option);
        }

        window.addEventListener('resize', function () {
            // 調整圖表大小以適應新的視窗大小
            myChart.resize();
        });
        cc(m);
        // ------------------------------------------------------------------------
        var x = 0;
        var chart = [];
        monthSelect.addEventListener('change', handleMonthChange);
        use.textContent = '1月總共使用' + String(monthele[0]) + '度';


        const dayBtn = document.getElementById("day-btn");
        const weekBtn = document.getElementById("week-btn");
        const average = document.getElementById('average used')
        average.textContent = standard[0];
        document.getElementById('overstandard').textContent = overstandard;

        dayBtn.addEventListener("click", function () {
            p = 0;
            // dayBtn跟weekbtn屬性交換
            dayBtn.classList.remove("btn", "btn-dark", "btn-sm", "me-3");
            dayBtn.classList.add("btn", "btn-secondary", "text-dark", "btn-sm", "me-3");
            weekBtn.classList.remove("btn", "btn-secondary", "text-dark", "btn-sm", "me-3");
            weekBtn.classList.add("btn", "btn-dark", "btn-sm", "me-3");
            cc(m);
        });


        weekBtn.addEventListener("click", function () {
            p = 1;
            // dayBtn跟weekbtn屬性交換
            weekBtn.classList.remove("btn", "btn-dark", "btn-sm", "me-3");
            weekBtn.classList.add("btn", "btn-secondary", "text-dark", "btn-sm", "me-3");
            dayBtn.classList.remove("btn", "btn-secondary", "text-dark", "btn-sm", "me-3");
            dayBtn.classList.add("btn", "btn-dark", "btn-sm", "me-3");
            cc(m);
        });

    </script>

    </div>


{% endblock content %}